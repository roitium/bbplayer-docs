---
title: 下载
editLink: true
---

### 下载

我也给 BBPlayer 简单搓了个下载功能：

* **缓存整个歌单**：在播放列表页面点「:arrow_down:」按钮。（是增量下载，已经下载过的就不会再下了）
* **下载单曲**：在歌曲右侧菜单里点「缓存音频」。

下载管理页面在「音乐库」的右上角。下载进度会显示在通知栏里，要是看不见，记得去系统设置给个通知权限。

已经下载的音频，歌曲时长旁边会有一个「:white_check_mark:」emoji。同时播放器顶部也会显示「已缓存」

### Q&A

#### 下载错误：文件头校验不通过？

下载的音频偶尔会抽风，字节数与正常文件完全相同，但内容是坏的，我觉得应该不是网络的问题，只能是 BiliBili 的问题，但很诡异就是了。我暂时没找到完美的解决办法，就加了个文件头校验（简单来说，会在下载前判断文件前几个字节包不包含正常音乐文件的 magic number，如果不包含就抛出这个错误）。所以如果提示「文件头校验不通过」，手动重试几次，大概率就好了。

#### 下载的文件格式？占空间吗？耗流量吗？

B 站只给 m4s 格式的音频流，~~而且码率低得可怜~~，所以一首歌也就 8MB 左右，别担心流量和空间。

#### 下载的文件藏哪儿了？

为了遵循 Google 的规范（~~说白了就是懒得搞~~），下载文件都放在 App 的私有目录里。手机没 Root 的话你是看不到的。至于导出功能，再说吧...（当然我欢迎你来 pr！！！其实单文件导出功能并不复杂！！！）